<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Soulify Admin Dashboard - Monitor user activity and analytics">
  <meta name="theme-color" content="#6366f1">
  <title>Soulify - Admin Dashboard</title>
  <link rel="stylesheet" href="/admin.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>
  <div class="container">
    <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
      <h1>Admin Dashboard</h1>
      <button id="toggleMode" class="mode-btn">&#x1F319;</button>
    </header>
    <div class="online-users">
      <h2>Current Online Users: <span id="onlineCount">0</span></h2>
    </div>
    <div class="user-activity">
      <h2>Daily User Activity</h2>
      <table id="userTable">
        <thead>
          <tr>
            <th>User ID</th>
            <th>Connect Time</th>
            <th>Disconnect Time</th>
            <th>Duration (minutes)</th>
          </tr>
        </thead>
        <tbody>
          <!-- User data will be populated here -->
        </tbody>
      </table>
    </div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // Update URL in browser without page reload
    if (window.location.pathname === '/admin') {
      history.replaceState(null, null, '/admin$panel');
    }
    
    const socket = io();

    socket.on('updateOnlineUsers', (count) => {
      document.getElementById('onlineCount').textContent = count;
    });

    // Fetch user activity data from the server
    fetch('/user-activity')
      .then(response => response.json())
      .then(data => {
        const userTable = document.getElementById('userTable').querySelector('tbody');
        userTable.innerHTML = '';

        data.forEach(user => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${user.id}</td>
            <td>${user.connectTime}</td>
            <td>${user.disconnectTime}</td>
            <td>${user.duration}</td>
          `;
          userTable.appendChild(row);
        });
      });

    // Dark/Light Mode Toggle
    const toggleButton = document.getElementById('toggleMode');
    toggleButton.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      if (document.body.classList.contains('dark-mode')) {
        toggleButton.innerHTML = '&#x2600;';
      } else {
        toggleButton.innerHTML = '&#x1F319;';
      }
    });
  </script>
</body>
</html>
